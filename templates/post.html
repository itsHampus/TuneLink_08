{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">

  <!-- Visa tråd -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <h2 class="card-title text-center">{{ thread.title }}</h2>
      <p class="text-muted text-center">Postad av användare {{ thread.creator_id }} • {{ thread.updated_at }}</p>
      <p class="card-text">{{ thread.description }}</p>

      {% if thread.spotify_url %}
        <div class="text-center mt-3">
          <iframe src="https://open.spotify.com/embed/track/{{ thread.spotify_url | replace('https://open.spotify.com/track/', '') }}"
                  width="300" height="80" frameborder="0" allowtransparency="true" allow="encrypted-media">
          </iframe>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- Kommentarer -->
  <h4>Kommentarer</h4>
  {% if comments %}
    <ul class="list-group mb-4">
      {% for comment in comments %}
        <li class="list-group-item">
          <strong>{{ comment.user_name }}</strong> <span class="text-muted">säger:</span><br>
          {{ comment.description }}
          {% if comment.spotify_url %}
            <div class="mt-2">
              <iframe src="https://open.spotify.com/embed/track/{{ comment.spotify_url | replace('https://open.spotify.com/track/', '') }}"
                      width="300" height="80" frameborder="0" allowtransparency="true" allow="encrypted-media">
              </iframe>
            </div>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>Inga kommentarer än. Bli den första att kommentera!</p>
  {% endif %}

  <!-- Modal för redigering -->
  <div class="modal fade" id="edit_comment_modal_{{ comment.id }}" tabindex="-1" aria-labelledby="editCommentLabel_{{ comment.id }}" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <form method="post" action="{{ url_for('edit_comment_get', comment_id=comment.id) }}">
          <div class="modal-header">
            <h5 class="modal-title" id="editCommentLabel_{{ comment.id }}">Redigera kommentar</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Stäng"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="edit_description_{{ comment.id }}" class="form-label">Kommentar</label>
              <textarea class="form-control" name="description" id="edit_description_{{ comment.id }}" rows="3" required>{{ comment.description }}</textarea>
            </div>
            <div class="mb-3">
              <label for="edit_spotify_url_{{ comment.id }}" class="form-label">Spotify URL</label>
              <input type="text" class="form-control" name="spotify_url" id="edit_spotify_url_{{ comment.id }}" value="{{ comment.spotify_url }}">
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Spara</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Avbryt</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Lägg till kommentar -->
  <div class="card">
    <div class="card-body">
      <h5 class="card-title">Lägg till en kommentar</h5>
      <form method="post" action="{{ url_for('submit_comment', thread_id=thread.id) }}">
        <div class="mb-3">
          <label for="comment_description" class="form-label">Kommentar</label>
          <textarea name="description" id="comment_description" class="form-control" rows="3" required></textarea>
        </div>
        <div class="mb-3">
          <label for="spotify_url" class="form-label">Spotify URL (valfritt)</label>
          <input type="url" name="spotify_url" id="spotify_url" class="form-control">
        </div>
        <button type="submit" class="btn btn-primary">Kommentera</button>
      </form>
    </div>
  </div>

</div>

<!-- edit comment button -->
<button class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#edit_comment_modal_{{ comment.id }}">
  <i class="bi bi-pencil"></i>
</button>
{% endblock %}
